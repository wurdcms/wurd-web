!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).wurd=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var r=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.rawContent=n}return n(e,[{key:"get",value:function(t){return t?t.split(".").reduce((function(t,e){return t&&t[e]}),this.rawContent):this.rawContent}},{key:"getSections",value:function(t){var e=this,n=t.map((function(t){return[t,e.rawContent[t]]}));return Object.fromEntries(n)}},{key:"setSections",value:function(t){Object.assign(this.rawContent,t)}}]),e}(),o=function(){function e(n,r){var o=this;t(this,e),this.wurd=n,this.path=r,this._get=n.store.get.bind(n.store),Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach((function(t){o[t]=o[t].bind(o)}))}return n(e,[{key:"id",value:function(t){return t?this.path?[this.path,t].join("."):t:this.path}},{key:"get",value:function(t){var e=this._get(this.id(t));if(void 0===e&&this.wurd.draft){var n=t.split(".")[0];this._get(n)||console.warn("Tried to access unloaded section: ".concat(n))}return e}},{key:"text",value:function(t,e){var n=this.get(t);return void 0===n?this.wurd.draft?"[".concat(t,"]"):"":"string"!=typeof n?(console.warn("Tried to get object as string: ".concat(t)),this.wurd.draft?"[".concat(t,"]"):""):(e&&(n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"!=typeof t?t:t.replace(/{{([\w.-]+)}}/g,(function(t,n){return e[n]||""}))}(n,e)),n)}},{key:"markdown",value:function(t,e,n){var r=this.wurd.markdown,o=r.parse,i=r.parseInline,a=this.text(t,e);return null!=n&&n.inline&&i?i(a):o?o(a):a}},{key:"map",value:function(t,e){var n,r,o,i=this,a=this.get(t)||(n={},r=Date.now(),o={},r in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n),c=0;return Object.keys(a).sort().map((function(n){var r=c;c++;var o=[t,n].join("."),a=i.block(o);return e.call(void 0,a,r)}))}},{key:"block",value:function(t,n){var r=this.id(t),o=new e(this.wurd,r);return"function"==typeof n?n.call(void 0,o):o}},{key:"el",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.id(t),o=n.markdown?this.markdown(t,e):this.text(t,e),i=e||n.markdown?"data-wurd-md":"data-wurd";if(this.wurd.draft){var a=n.type||"span";return n.markdown&&(a="div"),"<".concat(a," ").concat(i,'="').concat(r,'">').concat(o,"</").concat(a,">")}return o}}]),e}(),i=function(){function e(n,i){var a=this;t(this,e),this.store=new r,this.content=new o(this,null),Object.getOwnPropertyNames(Object.getPrototypeOf(this.content)).forEach((function(t){a[t]=a.content[t].bind(a.content)})),this.connect(n,i)}return n(e,[{key:"connect",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(this.app=t,this.draft=!1,this.editMode=!1,["draft","lang","markdown","debug"].forEach((function(t){var r=n[t];void 0!==r&&(e[t]=r)})),n.editMode){case!0:this.startEditor();break;case"querystring":/[?&]edit(&|$)/.test(location.search)&&this.startEditor()}return n.rawContent&&this.store.setSections(n.rawContent),n.blockHelpers&&this.setBlockHelpers(n.blockHelpers),this}},{key:"load",value:function(t){var e=this,n=this.app,r=this.store,o=this.debug;return new Promise((function(i,a){if(!n)return a(new Error("Use wurd.connect(appName) before wurd.load()"));"string"==typeof t&&(t=t.split(","));var c=r.getSections(t),s=Object.keys(c).filter((function(t){return void 0===c[t]}));return o&&console.info("from cache: ",s),s.length?(o&&console.info("from server: ",s),e._fetchSections(s).then((function(t){r.setSections(t),i(e.content)})).catch((function(t){return a(t)}))):i(e.content)}))}},{key:"_fetchSections",value:function(t){var e,n=this,r=this.app,o=["draft","lang"].reduce((function(t,e){return n[e]&&(t[e]=n[e]),t}),{}),i="".concat("https://api.wurd.io","/apps/").concat(r,"/content/").concat(t,"?").concat((e=o,Object.keys(e).map((function(t){var n=e[t];return encodeURIComponent(t)+"="+encodeURIComponent(n)})).join("&")));return this._fetch(i).then((function(e){if(e.error)throw e.error.message?new Error(e.error.message):new Error("Error loading ".concat(t));return e}))}},{key:"_fetch",value:function(t){return fetch(t).then((function(e){if(!e.ok)throw new Error("Error loading ".concat(t,": ").concat(e.statusText));return e.json()}))}},{key:"startEditor",value:function(){var t=this.app,e=this.lang;this.editMode=!0,this.draft=!0;var n=document.createElement("script");n.src="https://widget.wurd.io/widget.js",n.async=!0,n.setAttribute("data-app",t),e&&n.setAttribute("data-lang",e),document.getElementsByTagName("body")[0].appendChild(n)}},{key:"setBlockHelpers",value:function(t){Object.assign(o.prototype,t)}}]),e}(),a=new i;return a.Wurd=i,a}));
